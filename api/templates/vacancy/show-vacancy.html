{% extends 'base.html' %}

{% block title %}
DRW
{% endblock %}

{% block content %}

<div class="container">
    <h1 style="text-align: center;"></h1>
    <div>
        <div style="margin-bottom: 50px; margin-top: 42px;">
            {% csrf_token %}
            {% if is_owner == True %}
            <div class="d-flex justify-content-center">
                <a class="btn btn-outline-success flex-fill mx-1" href="#" id="editBtn">Edit vacancy</a>
                <a class="btn btn-outline-primary flex-fill mx-1" href="#" id="manageBtn">Manage vacancy</a>
            </div>
            <div class="d-flex mt-1">
                <button class="btn btn-outline-danger flex-fill justify-content-center" onclick="" id="delBtn">
                    Delete vacancy
                </button>
            </div>
            {% endif %}
        </div>

        <div class="row" id="company-salary-info">
            <div class="col">
                <!-- add a logo -->
                <h2>
                    <a class="link-offset-1 link-dark link-opacity-75-hover link-underline-opacity-75-hover" href="#"
                        id="owner">
                    </a>
                </h2>
                <p id="owner-email">
                </p>
                <p id="owner-phone">
                </p>
            </div>
            <div class="col">
                <h2>Salary</h2>
                <p id="salary">
                </p>
            </div>
        </div>
        <div class="row" id="location-info">
            <div class="col">
                <h2>Location</h2>
                <p id="location"></p>
            </div>
        </div>
        <div id="vacancy-info">
            <h2>Description</h2>
            <p id="text">
            </p>
            <h2>Tags:</h2>
            <div id="tags">
            </div>
        </div>
        <div class="d-flex flex-row flex-wrap justify-content-center" id="media">
        </div>
    </div>
    {% if user.role == "employee" %}
    <div class="d-flex mt-3" id="applyDiv">
        <button class="btn btn-success flex-fill" onclick="applyForVac(this)" id="{{ user.id }}">Apply for a
            vacancy</button>
    </div>
    {% endif %}
</div>

{% csrf_token %}
{% load static %}
<script>
    const csrfToken = document.querySelector("[name=csrfmiddlewaretoken]").value;
</script>
<script src="{% static 'js/retrieve-media.js' %}" async></script>
<script src="{% static 'js/show-vacancy.js' %}" async></script>
<script>
    async function loadMedia() {
        const mediaDiv = document.getElementById('media');
        const [medias, urls] = await getMediaUrlList('vacancy', vacancyId);

        if (medias && urls) {
            mediaDiv.innerHTML = "";
            for (let url of urls) {
                mediaDiv.insertAdjacentHTML('beforeend',
                    `<img src="${url}" class="rounded-3 p-3 border border-2 m-1" alt="error"
                    style="height: 200px; width: 300px; display: flex;">`
                )
            }
        }
    }
    // async function loadMediaFromVacancy() {
    //     console.log('running');

    //     if (vacancyMedia) {
    //         for (let media of vacancyMedia) {
    //             let imageUrl = await getMediaUrl(media.id)
    //             mediaDiv.insertAdjacentHTML('beforeend',
    //                 `<img src="${imageUrl}" class="rounded-3 p-3 border border-2 m-1" alt="error"
    //                 style="height: 200px; width: 300px; display: flex;">`
    //             )
    //         }
    //     }
    // }
    // loadMediaFromVacancy()
</script>
{% endblock %}